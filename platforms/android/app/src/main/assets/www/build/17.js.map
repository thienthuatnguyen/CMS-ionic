{"version":3,"sources":["../../src/pages/reservation-list/reservation-list.module.ts","../../src/pages/reservation-list/reservation-list.ts"],"names":[],"mappings":"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","file":"17.js","sourcesContent":["import { NgModule, Pipe } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { ReservationListPage } from './reservation-list';\n\n@NgModule({\n  declarations: [\n    ReservationListPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ReservationListPage),\n    TranslateModule.forChild()\n\n  ],\n})\nexport class ReservationListPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/reservation-list/reservation-list.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ToastController, ViewController, ModalController } from 'ionic-angular';\nimport { _ } from 'underscore';\nimport { Util } from '../../providers';\nimport { ReservationPage } from \"../reservation/reservation\";\nimport { TestDriveReadyPage } from \"../test-drive-ready/test-drive-ready\";\nimport { MainPage } from \"../index\";\nimport { ReservationService } from '../../services/reservation.service';\nimport { ReservationModel } from '../../models/reservation/reservation.model';\nimport moment from 'moment';\nimport { Config } from '../../app/app.config';\nimport { UserInfoModel } from '../../models/userInfo.model';\nimport { IvtStorageService, IvtSecurityService } from '@ivt/security';\nimport { ToastService } from '../../services/toast.service';\nimport { TranslateService } from '@ngx-translate/core/src/translate.service';\nimport { AppSettingModel } from '../../models/config/app.setting.model';\nimport { DriveShootingPage } from '../../pages/drive-shooting/drive-shooting';\nimport { CameraService } from '../../services/camera.service';\nimport { FileService } from '../../services/file.service';\nimport { VehicleOdometerModel } from '../../models/VehicleOdometer.model';\nimport { VehicleOdometerService } from '../../services/vehicle.odometer.service';\n@IonicPage()\n@Component({\n  selector: 'page-reservation-list',\n  templateUrl: 'reservation-list.html'\n})\nexport class ReservationListPage {\n  private currentUser: boolean = false;\n  private userId: any;\n  private list:any = [];\n  private reservationList: any = [];\n  private params: any;\n  private validateMessage: string;\n  private appSetting: AppSettingModel;\n  today:Date;\n  resultList: any = [];  \n  displayDateFormat = Config.date.displayShortTime;\n\n  constructor(public navCtrl: NavController, \n              public navParams: NavParams, \n              private viewCtrl: ViewController, \n              private service: ReservationService,\n              private util: Util,\n              private translateService: TranslateService,\n              private toastService: ToastService, \n              private securityService: IvtSecurityService,\n              private storeage: IvtStorageService,\n              private modalCtrl: ModalController,\n              private camera: CameraService,\n              private fileSvc: FileService,\n              private vehicleOdometerService: VehicleOdometerService\n  ) {\n    let userInfor = this.securityService.getUser();\n    this.userId = userInfor.id;\n    this.today = moment(moment().format(Config.date.YYYYMMDD),Config.date.YYYYMMDD).toDate();\n    this.translateService.get('reservation.you_can_only_proceed_with_your_reservation').subscribe((value) => {\n      this.validateMessage = value;\n    })\n\n    this.getAppSetting();\n  }\n\n  private getReservationList(searchCriteria: any){\n    this.service.getReservationList(searchCriteria).subscribe((reservations:ReservationModel[])=>{\n       this.list = this.util.transformToReservationList(reservations);\n       this.resultList = this.util.transformToGroupBy(this.list,'appointmentDateLocal');\n    },fail=>{\n      // to do will show error message \n  });\n  }\n\n  private getAppSetting() {\n    this.appSetting = this.storeage.get(Config.AppSetting);\n  }\n\n  ionViewDidEnter() {\n    this.params = {\n           appointmentFromDateLocal: moment().format(Config.date.YYYYMMDD)\n         }\n    this.getReservationList(this.params);\n  }\n\n  toggleUser(){\n    this.currentUser = !this.currentUser;\n    let userItems = this.list;\n    if(this.currentUser)\n      userItems = _.where(this.list, {consultantUserId : this.userId}); \n    this.resultList = this.util.transformToGroupBy(userItems,'appointmentDateLocal');\n  }\n\n  changeDate(selectedDate){\n    this.params = {\n      appointmentFromDateLocal: moment(selectedDate).format(Config.date.YYYYMMDD),\n      appointmentToDateLocal: moment(selectedDate).format(Config.date.YYYYMMDD)\n    }\n    this.getReservationList(this.params);\n  }\n\n  showCreateDocument(applicationStatusEnum: any){\n    return Config.reservation.createDocument.indexOf(applicationStatusEnum) >= 0\n  }\n\n  showEditDocument(applicationStatusEnum: any){\n    return Config.reservation.editDocument.indexOf(applicationStatusEnum) < 0\n  }\n\n  showStartDriver(applicationStatusEnum: any){\n    return Config.reservation.startDrive.indexOf(applicationStatusEnum) >= 0\n  }\n  /**\n   * Perform a service for the proper items.\n   */\n  searchByKeyWord(ev) {\n    if(ev.target.value===undefined)\n      this.resultList = this.util.transformToGroupBy(this.list,'appointmentDateLocal');\n    else{\n      var result = _.filter(this.list, item => {\n      return(\n        item.customerFullName.toLowerCase().indexOf(ev.target.value.toLowerCase()) >= 0\n        || item.vehicleDisplayName.toLowerCase().indexOf(ev.target.value.toLowerCase()) >= 0\n        || item.consultantUserName.toLowerCase().indexOf(ev.target.value.toLowerCase()) >= 0)\n      });\n      this.resultList = this.util.transformToGroupBy(result,'appointmentDateLocal');\n    }\n  }\n\n  \n  /**\n   * Navigate to the detail page for this item.\n   */\n  editReservation(item: ReservationModel) {\n      this.navCtrl.push('ReservationPage', {\n        item: item\n      });\n  }\n\n  updateDocument(item: ReservationModel) {\n    this.navCtrl.push('DocumentPage', {\n      item: item\n    });\n  }\n\n  openTestDriveReady(item: ReservationModel) {\n    if(this.isOwnReservation(item)){\n      // if(this.appSetting.smartTestDriveSetting.tenantSide.performTakingOdometerPhotoBeforeAndAfterTestDrive) {\n      //   let profileModal = this.modalCtrl.create(DriveShootingPage, {\n      //     pageType: 'odometer',\n      //     page: 'reservation-list'\n      //   });\n\n      //   profileModal.onDidDismiss(data => {\n      //     this.camera.getPicture().then(\n      //       _base64 => {      \n      //         this.fileSvc.upload(_base64, { fileName: this.generateUniqueFileName() }).then(\n      //           _id => {\n      //             let vehicleOdometerModel = new VehicleOdometerModel();\n      //             vehicleOdometerModel.applicationId = item.id;\n      //             vehicleOdometerModel.odometerPictureId = _id;\n                  \n      //             this.vehicleOdometerService.save(vehicleOdometerModel).subscribe(res => {\n                    this.navCtrl.setRoot('TestDriveReadyPage', {\n                      item: item\n                    });\n        //           })\n        //         }    \n        //       )\n        //     }\n        //   )\n        // });\n        // profileModal.present();\n      // }\n      // else {\n      //   this.navCtrl.setRoot('TestDriveReadyPage', {\n      //     item: item\n      //   });\n      // }\n    }\n    else{\n      this.toastService.error(this.validateMessage);\n    }\n  }\n  \n  isOwnReservation(item): boolean {\n    if (item.consultantUserId)\n      return item.consultantUserId == this.userId\n    return false;\n  }\n\n  dismiss() {\n    this.viewCtrl.dismiss();\n  }\n\n  private generateUniqueFileName(): string {\n    return new Date().getTime().toString() + this.fileSvc.FILE_EXTENSION;\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/reservation-list/reservation-list.ts"],"sourceRoot":""}
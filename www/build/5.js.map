{"version":3,"sources":["../../src/pages/test-page/test.page.module.ts","../../src/component/camera/camera.component.ts","../../src/component/component.module.ts","../../src/pages/test-page/test.page.ts"],"names":[],"mappings":"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","file":"5.js","sourcesContent":["import { NgModule } from \"@angular/core\";\nimport { TestPage } from \"./test.page\";\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from \"@ngx-translate/core\";\nimport { ComponentModule } from \"../../component/component.module\";\n\n@NgModule({\n    declarations: [\n        TestPage,\n    ],\n    imports: [\n        IonicPageModule.forChild(TestPage),\n        TranslateModule.forChild(),\n        ComponentModule\n    ],\n    exports: [\n        TestPage\n    ]\n})\nexport class TestPageModule {\n\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/test-page/test.page.module.ts","import { Component, Input } from '@angular/core';\nimport { CameraService } from \"../../services/camera.service\";\nimport { FileService } from \"../../services/file.service\";\nimport { Picture } from \"../../models/picture.model\";\nimport { APIResponse, APICode } from \"@ivt/http-client\";\nimport { DomSanitizer } from \"@angular/platform-browser\";\nimport { AlertController, ModalController } from \"ionic-angular\";\nimport { TranslateService } from \"@ngx-translate/core\";\nimport { DriveShootingPage } from \"../../pages/drive-shooting/drive-shooting\"\nimport { ImageModal } from '../../pages/vehicle-health-check/imageModal/image-modal';\n\n@Component({\n    selector: 'ivt-camera',\n    templateUrl: './camera.component.html'\n})\nexport class CameraComponent {\n    confirmWord: string;\n    okWord: string;\n    cancelWord: string;\n    _frontPictures: Array<Picture> = [];\n    _backPictures: Array<Picture> = [];\n\n    @Input() noSpashScreen: boolean;\n\n    @Input() \n    get frontPictures() {\n        return this._frontPictures;\n    };\n    set frontPictures(val) {\n        this._frontPictures = val;\n    }\n    @Input()\n    get backPictures() {\n        return this._backPictures;\n    };\n    set backPictures(val) {\n        this._backPictures = val;\n    }\n\n    multiple = false;\n\n    constructor(\n        private camera: CameraService,\n        private fileSvc: FileService,\n        public domSanitizer: DomSanitizer,\n        private alertCtrl: AlertController,\n        private translate: TranslateService,\n        private modalCtrl: ModalController\n    ) {\n        translate.get('DELETE_CAMERA_IMAGE').subscribe((value) => {\n            this.confirmWord = value;\n        })\n        translate.get('OK_BUTTON').subscribe((value) => {\n            this.okWord = value;\n        })\n        translate.get('CANCEL_BUTTON').subscribe((value) => {\n            this.cancelWord = value;\n        })\n    }\n    takePhoto(side: string) {\n        if(this.noSpashScreen) {\n            this.cameraGetPicture(side);\n        }\n        else {\n            let profileModal = this.modalCtrl.create('DriveShootingPage', {\n                pageType: side\n            }, {\n                cssClass: 'full-modal'\n            });\n    \n            profileModal.onDidDismiss(data => {\n                this.cameraGetPicture(side);\n            });\n            profileModal.present();    \n        }\n    }\n\n    cameraGetPicture(side: string) {\n        this.camera.getPicture().then(\n            _base64 => this.storePhotos(side, _base64)\n        )\n    }\n\n    storePhotos(side: string, base64: string): any {\n        let picture = new Picture();\n        picture.url = base64;\n        if (side === 'front') {\n            if (this.multiple === false) {\n                this._frontPictures.splice(0, 1, picture);\n            } else {\n                this._frontPictures.push(picture)\n            }\n        } else if (side === 'back') {\n            if (this.multiple === false) {\n                this._backPictures.splice(0, 1, picture);\n            } else {\n                this._backPictures.push(picture);\n            }\n        }\n    }\n    upload(): Promise<CameraUploadResult> {\n        return new Promise(\n            (resolver, rejecter) => {\n                let uploadRequests = [];\n                let photos = this._frontPictures.concat(this._backPictures);\n                photos.forEach(_picture => {\n                    if (_picture.id == null) {\n                        uploadRequests.push(this.fileSvc.upload(_picture.url, { fileName: this.generateUniqueFileName() }).then(\n                            _id => _picture.id = _id\n                        ))\n                    }\n                });\n                // TODO: handle error\n                Promise.all(uploadRequests).then(_ => {\n                    resolver({\n                        _frontPictures: this._frontPictures,\n                        _backPictures: this._backPictures\n                    });\n                });\n            }\n        );\n        ;\n\n    }\n\n    deletePhoto(side: string) {\n        let item;\n        if (side === 'front') {\n            item = this._frontPictures[0];\n        } else if (side === 'back') {\n            item = this._backPictures[0];\n        }\n\n        let profileModal = this.modalCtrl.create('ImageModal', item, {\n            cssClass: 'full-modal'\n        });\n        profileModal.onDidDismiss(data => {\n        if (data) {\n            if (side === 'front') {\n                this._frontPictures.splice(0, this._frontPictures.length);\n            } else if (side === 'back') {\n                this._backPictures.splice(0, this._backPictures.length);\n            }  \n        }\n        });\n        profileModal.present();\n\n        // let confirm = this.alertCtrl.create({\n        //     title:  this.confirmWord,\n        //     message: '',\n        //     buttons: [\n        //       {\n        //         text: this.cancelWord,\n        //         handler: () => {\n        //         }\n        //       }, {\n        //         text: this.okWord,\n        //         handler: () => {\n        //             if (side === 'front') {\n        //                 this._frontPictures.splice(0, this._frontPictures.length);\n        //             } else if (side === 'back') {\n        //                 this._backPictures.splice(0, this._backPictures.length);\n        //             }  \n        //         }\n        //       }\n        //     ]\n        //   });\n        //   confirm.present();\n    }\n\n    private generateUniqueFileName(): string {\n        return new Date().getTime().toString() + this.fileSvc.FILE_EXTENSION;\n    }\n}\n\nexport interface CameraUploadResult {\n    _frontPictures: Array<Picture>;\n    _backPictures: Array<Picture>;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/component/camera/camera.component.ts","import { NgModule } from '@angular/core';\nimport { IonicPageModule, IonicModule } from 'ionic-angular';\nimport { TranslateModule } from \"@ngx-translate/core\";\nimport { CameraComponent } from './camera/camera.component';\n\n@NgModule({\n  declarations: [\n    CameraComponent\n  ],\n  imports: [\n    TranslateModule.forChild(),\n    IonicModule\n  ],\n  exports: [\n    CameraComponent\n  ]\n})\nexport class ComponentModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/component/component.module.ts","import { IonicPage } from 'ionic-angular';\nimport { Component } from '@angular/core';\nimport { BluetoothService } from '../../services/bluetooth.service';\nimport { GeoService } from '../../services/geo.service';\nimport { BackgroundGeolocationResponse } from '@ionic-native/background-geolocation';\nimport { VehicleService } from '../../services/vehicle.service';\nimport { retryWhen, map, catchError, concat, delayWhen } from 'rxjs/operators';\nimport { Observable } from 'rxjs/Observable';\nimport { DialogService } from '../../services/dialog.service';\nimport { BluetoothSerial } from '@ionic-native/bluetooth-serial';\n@IonicPage()\n@Component({\n    selector: 'test-page',\n    templateUrl: 'test.page.html'\n})\nexport class TestPage {\n    internalSubscription: any;\n    devices: any = [];\n    lastRecordedLocation: any;\n    drivenMileage: number = 0;\n\n    constructor(\n        private bluetoothSvc: BluetoothService,\n        private geoSvc: GeoService,\n        private vehicleService: VehicleService,\n        private dialog: DialogService,\n        private bluetoothSerial: BluetoothSerial\n    ) {\n\n    }\n    async getVehicle() {\n        this.vehicleService.searchForHomePage()\n            .toPromise().then(\n                res => console.log(res),\n                err => console.error(err)\n            );\n    }\n    async blue() {\n        let ok = await this.bluetoothSvc.enable();\n        if (ok) {\n            this.internalSubscription = this.bluetoothSvc.scan().subscribe(\n                rs => {\n                    console.log('this=', this);\n                    rs && this.devices.push(rs);\n                },\n                err => console.error(err)\n            )\n        }\n    }\n    async serialScan() {\n        this.bluetoothSvc.discoverUnpaired().then(\n            devices => {\n                console.log('Serial list: ', devices);\n            }\n        )\n        this.bluetoothSerial.list().then(\n            devices => {\n                console.log('bonded devices=', devices);\n            }\n        )\n    }\n    async connect(id) {\n        this.internalSubscription && this.internalSubscription.unsubscribe();\n        this.bluetoothSvc.connect(id).subscribe();\n    }\n    async startGeo() {\n        let ok = await this.geoSvc.requestLocationPermission();\n        if (ok) {\n            ok = await this.geoSvc.requestLocationAccuracy();\n            if (ok) {\n\n                this.geoSvc.subscribe(\n                    async (loc: BackgroundGeolocationResponse) => {\n                        console.log('Get the first location');\n                        if (this.lastRecordedLocation) {\n                            this.drivenMileage += this.geoSvc.getDistanceFromLatLonInKm(this.lastRecordedLocation.latitude, this.lastRecordedLocation.longitude, loc.latitude, loc.longitude);\n                        }\n                        this.lastRecordedLocation = loc;\n                        console.log('Current mileage ', this.drivenMileage);\n                    }\n                )\n                this.geoSvc.start();\n            }\n        }\n    }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/test-page/test.page.ts"],"sourceRoot":""}